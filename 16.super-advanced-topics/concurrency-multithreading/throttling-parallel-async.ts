// Write a function processInBatches(tasks: (() => Promise<any>)[], batchSize: number) that runs tasks in limited parallel batches.